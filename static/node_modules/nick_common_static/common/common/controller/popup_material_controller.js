/**
 * Created by NICK on 15/9/16.
 * email:nick121212@126.com
 * qq:289412378
 * copyright NICK
 */
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
define(["require", "exports", 'common/common/controller/base_material_controller', 'common/libs/hybrid'], function (require, exports, baseController, hybrid) {
    /*
     * controller的基类
     * */
    var PopupController = (function (_super) {
        __extends(PopupController, _super);
        function PopupController(args) {
            _super.call(this, args);
            this.isBusy = false;
        }
        PopupController.prototype.getPlatInfo = function () {
            var _this = this;
            var promise;
            this.isBusy = true;
            promise = hybrid.Native.JsCall.getPlatInfo(this.$q);
            promise.then(function () {
                _this.isBusy = false;
            });
            return promise;
        };
        PopupController.prototype.submit = function ($form, serverData) {
            var _this = this, promises = {};
            _this.$rootScope.$broadcast('schemaFormValidate');
            if ($form.$dirty && $form.$valid && !_this.isBusy) {
                angular.forEach(_this.resolve, function (fn, key) {
                    promises[key] = fn(serverData || _this.formData);
                });
                _this.$promise = _this.$q.all(promises);
                if (_this.resolve && _this.$promise) {
                    _this.managerGrid && (_this.managerGrid.isBusy = true);
                    _this.isBusy = true;
                    _this.$promise.then(function (datas) {
                        $form.$setPristine();
                        if (_this.dialogCloseFn) {
                            _this.dialogCloseFn(datas);
                        }
                        else {
                            //_this.$mdDialog.hide();
                            _this.alert(_this.schema.description, _this.content).finally(function () {
                                _this.managerGrid && _this.managerGrid.getServerData && _this.managerGrid.getServerData();
                            });
                        }
                    }).finally(function () {
                        _this.managerGrid && (_this.managerGrid.isBusy = false);
                        _this.isBusy = false;
                        _this.$promise = null;
                    });
                }
            }
        };
        return PopupController;
    })(baseController.BaseController);
    exports.PopupController = PopupController;
});
//# sourceMappingURL=popup_material_controller.js.map